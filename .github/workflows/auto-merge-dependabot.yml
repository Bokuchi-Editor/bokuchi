name: Auto-merge Dependabot

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  auto-merge:
    runs-on: ubuntu-latest
    if: github.actor == 'dependabot[bot]' && contains(github.event.pull_request.labels.*.name, 'dependencies')

    steps:
    - name: Check if PR is ready
      id: check
      run: |
        # ãƒ‘ãƒƒãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æ›´æ–°ã®ã¿ã‚’è‡ªå‹•ãƒãƒ¼ã‚¸å¯¾è±¡ã¨ã™ã‚‹
        if [[ "${{ github.event.pull_request.title }}" =~ ^deps.*\(patch\)$ ]]; then
          echo "ready=true" >> $GITHUB_OUTPUT
        else
          echo "ready=false" >> $GITHUB_OUTPUT
        fi

    - name: Auto-merge PR
      if: steps.check.outputs.ready == 'true'
      uses: actions/github-script@v8
      with:
        script: |
          // è‡ªå‹•ãƒãƒ¼ã‚¸ã‚’æœ‰åŠ¹åŒ–
          await github.rest.pulls.enableAutoMerge({
            owner: context.repo.owner,
            repo: context.repo.repo,
            pull_number: context.issue.number,
            merge_method: 'squash'
          });

          // ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 
          await github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: 'ğŸ¤– ãƒ‘ãƒƒãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®æ›´æ–°ã®ãŸã‚ã€è‡ªå‹•ãƒãƒ¼ã‚¸ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã—ãŸã€‚'
          });
